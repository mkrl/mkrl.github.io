const l=(t,n,e)=>{const r=document.createElement(t);return n&&(r.className=n),e&&(r.innerHTML=e),r},g=(t,n=!1)=>{t.input.readOnly=!n,t.inputContainer.style.opacity=n?"":"0"},T=(t,n)=>{t.className="terminal";const e=l("div","terminal-container"),r=l("div","terminal-type"),s=l("span",void 0,n),o=l("input");return o.setAttribute("type","text"),r.append(s),r.append(o),t.append(e),t.append(r),t.addEventListener("click",()=>o.focus()),{commandContainer:e,input:o,inputContainer:r}};var $=T;const C=(t,n,e,r,s)=>{const o=l("p",void 0,n?s:t);if(n){const i=l("span","terminal-command",t);o.append(i)}e.append(o),r.scrollIntoView()};var I=C;const u=(t,n,e)=>{const r=new CustomEvent(t,{detail:e});n.dispatchEvent(r)},E=(t,n)=>{const{print:e}=n,[r,...s]=t.split(" "),o=s.join(" ").match(/('[^']+'|"[^"]+"|[^\s'"]+)/g),i=o===null?[]:o.map(p=>p.replace(/(^['"]|['"]$)/g,"")),c=n.settings.commands[r];c?c.argDescriptions&&c.argDescriptions.length>0&&i.length===0?e(`Usage: ${r} ${c.argDescriptions.map(p=>`[${p}]`).join(" ")}`):(c.func(n,...i),u("onCommand",n.settings.host,t)):(e(`<span class="terminal-error">command not found: ${r}</span>`),u("onCommand404",n.settings.host,t))};var y=E;const h=t=>{const{settings:{host:n}}=t;g(t),t.isProcessRunning=!0,u("onProcessStart",n)},f=t=>{const{input:n,settings:{host:e}}=t;g(t,!0),t.isProcessRunning=!1,n.focus(),u("onProcessStop",e)},P=(t,n,e,r)=>{h(e);const s=l("p");e.commandContainer.append(s);let o=0;const i=()=>{o<t.length&&e.isProcessRunning?(s.innerHTML+=t.charAt(o),o++,setTimeout(i,n)):(r&&r(),f(e))};setTimeout(i,n)};var H=P;const w=t=>{const{input:{value:n},history:e,settings:{historyLength:r}}=t;if(n!==e[0]){if(e.length>=r){t.history=[n,...e.slice(0,-1)];return}t.history=[n,...e],t.lastHistoryIndex=0}},v=(t,n)=>{const{history:e,lastHistoryIndex:r}=t,s=e.length-1;let o;n&&r===0||!n&&r===e.length||s<0||(n?(o=r-1,t.input.value=o-1>=0?e[o-1]:""):(o=r+1,t.input.value=e[r]),t.lastHistoryIndex=o)},A=(t,n)=>{const{input:e,print:r}=n;t.addEventListener("keyup",({key:s,ctrlKey:o})=>{if(o&&s==="c"&&n.isProcessRunning)r("^C"),f(n),u("onProcessInterrupt",t);else{if(n.isProcessRunning)return;if(s==="Enter"){n.lastHistoryIndex=0,e.value.length>0?(r(e.value,!0),w(n),y(e.value,n)):r(" ",!0),e.value="";return}if(s==="ArrowUp"){v(n);return}s==="ArrowDown"&&v(n,!0)}})},L=t=>({name:"help",description:"shows a full list of all available commands",func:({print:n})=>{for(const e in t.settings.commands)Object.hasOwnProperty.call(t.settings.commands,e)&&n(t.settings.commands[e].name+" - "+t.settings.commands[e].description)}});var R=L;const S='.terminal{overflow-y:auto;overflow-x:hidden;background-color:var(--terminal-bg-color, black);padding:15px;box-sizing:border-box}.terminal *{color:var(--terminal-fg-color, white);font-family:var(--terminal-font, "Courier New", monospace)}.terminal-type{width:100%;display:flex}.terminal-type>span{padding-right:7pt}.terminal-type>input{flex-grow:2;background:transparent;border:0;font-size:inherit;padding:0}.terminal-type>input:focus{border:none;outline:none}.terminal-container>p{margin:0}span.terminal-command{color:var(--terminal-accent-color, #ffff7d)}span.terminal-error{color:var(--terminal-error-color, #cc1010)}';var N=S;const O=()=>{if(document.head.querySelectorAll('link[data-type="terminal"]').length===0){const t=l("style",void 0,N);t.setAttribute("data-type","terminal"),t.setAttribute("type","text/css"),document.head.append(t)}};var j=O;const M=({host:t,welcomeMessage:n,prompt:e="$: ",historyLength:r=50,enableHelp:s=!0,commands:o})=>{const i={host:t,welcomeMessage:n,prompt:e,historyLength:r,enableHelp:s,commands:o};j();const{commandContainer:c,input:p,inputContainer:x}=$(t,e),a={history:[],lastHistoryIndex:0,isProcessRunning:!1,settings:i,commandContainer:c,inputContainer:x,input:p,print:(d,m=!1)=>I(d,m,c,p,e),run:d=>y(d,a),start:()=>h(a),stop:()=>f(a),type:(d,m=60,b)=>H(d,m,a,b)};return s&&(a.settings.commands.help=R(a)),A(t,a),u("onInit",t),n&&a.print(n),a};var k=M;export{k as i};
